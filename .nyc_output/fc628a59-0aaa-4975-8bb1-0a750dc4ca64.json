{"/Users/chris/Documents/projects/ispindel-multiservice/src/app.ts":{"path":"/Users/chris/Documents/projects/ispindel-multiservice/src/app.ts","statementMap":{"0":{"start":{"line":2,"column":22},"end":{"line":4,"column":1}},"1":{"start":{"line":3,"column":4},"end":{"line":3,"column":62}},"2":{"start":{"line":5,"column":0},"end":{"line":5,"column":62}},"3":{"start":{"line":6,"column":18},"end":{"line":6,"column":53}},"4":{"start":{"line":7,"column":17},"end":{"line":7,"column":53}},"5":{"start":{"line":8,"column":16},"end":{"line":8,"column":60}},"6":{"start":{"line":9,"column":18},"end":{"line":9,"column":64}},"7":{"start":{"line":10,"column":15},"end":{"line":10,"column":58}},"8":{"start":{"line":11,"column":24},"end":{"line":11,"column":76}},"9":{"start":{"line":12,"column":0},"end":{"line":31,"column":2}},"10":{"start":{"line":14,"column":4},"end":{"line":21,"column":5}},"11":{"start":{"line":15,"column":8},"end":{"line":15,"column":62}},"12":{"start":{"line":19,"column":8},"end":{"line":19,"column":25}},"13":{"start":{"line":20,"column":8},"end":{"line":20,"column":24}},"14":{"start":{"line":22,"column":33},"end":{"line":22,"column":39}},"15":{"start":{"line":23,"column":16},"end":{"line":23,"column":44}},"16":{"start":{"line":24,"column":4},"end":{"line":24,"column":47}},"17":{"start":{"line":25,"column":4},"end":{"line":25,"column":49}},"18":{"start":{"line":26,"column":4},"end":{"line":26,"column":46}},"19":{"start":{"line":27,"column":4},"end":{"line":27,"column":55}},"20":{"start":{"line":28,"column":4},"end":{"line":28,"column":56}},"21":{"start":{"line":28,"column":37},"end":{"line":28,"column":53}},"22":{"start":{"line":29,"column":4},"end":{"line":29,"column":67}},"23":{"start":{"line":29,"column":44},"end":{"line":29,"column":64}},"24":{"start":{"line":30,"column":4},"end":{"line":30,"column":15}}},"fnMap":{"0":{"name":"(anonymous_0)","decl":{"start":{"line":2,"column":56},"end":{"line":2,"column":57}},"loc":{"start":{"line":2,"column":71},"end":{"line":4,"column":1}},"line":2},"1":{"name":"(anonymous_1)","decl":{"start":{"line":12,"column":18},"end":{"line":12,"column":19}},"loc":{"start":{"line":12,"column":34},"end":{"line":31,"column":1}},"line":12},"2":{"name":"(anonymous_2)","decl":{"start":{"line":28,"column":24},"end":{"line":28,"column":25}},"loc":{"start":{"line":28,"column":37},"end":{"line":28,"column":53}},"line":28},"3":{"name":"(anonymous_3)","decl":{"start":{"line":29,"column":31},"end":{"line":29,"column":32}},"loc":{"start":{"line":29,"column":44},"end":{"line":29,"column":64}},"line":29}},"branchMap":{"0":{"loc":{"start":{"line":2,"column":22},"end":{"line":4,"column":1}},"type":"binary-expr","locations":[{"start":{"line":2,"column":23},"end":{"line":2,"column":27}},{"start":{"line":2,"column":31},"end":{"line":2,"column":51}},{"start":{"line":2,"column":56},"end":{"line":4,"column":1}}],"line":2},"1":{"loc":{"start":{"line":3,"column":11},"end":{"line":3,"column":61}},"type":"cond-expr","locations":[{"start":{"line":3,"column":37},"end":{"line":3,"column":40}},{"start":{"line":3,"column":43},"end":{"line":3,"column":61}}],"line":3},"2":{"loc":{"start":{"line":3,"column":12},"end":{"line":3,"column":33}},"type":"binary-expr","locations":[{"start":{"line":3,"column":12},"end":{"line":3,"column":15}},{"start":{"line":3,"column":19},"end":{"line":3,"column":33}}],"line":3},"3":{"loc":{"start":{"line":15,"column":17},"end":{"line":15,"column":61}},"type":"binary-expr","locations":[{"start":{"line":15,"column":17},"end":{"line":15,"column":28}},{"start":{"line":15,"column":32},"end":{"line":15,"column":61}}],"line":15},"4":{"loc":{"start":{"line":22,"column":12},"end":{"line":22,"column":28}},"type":"default-arg","locations":[{"start":{"line":22,"column":25},"end":{"line":22,"column":28}}],"line":22}},"s":{"0":1,"1":6,"2":1,"3":1,"4":1,"5":1,"6":1,"7":1,"8":1,"9":1,"10":1,"11":1,"12":0,"13":0,"14":1,"15":1,"16":1,"17":1,"18":1,"19":1,"20":1,"21":1,"22":1,"23":0,"24":1},"f":{"0":6,"1":1,"2":1,"3":0},"b":{"0":[1,1,1],"1":[5,1],"2":[6,6],"3":[1,0],"4":[0]},"inputSourceMap":{"version":3,"file":"/Users/chris/Documents/projects/ispindel-multiservice/src/app.ts","sources":["/Users/chris/Documents/projects/ispindel-multiservice/src/app.ts"],"names":[],"mappings":";;;;;AAAA,sDAAwD;AACxD,sDAA6C;AAC7C,6DAAqC;AACrC,iEAAyC;AACzC,2DAAuC;AACvC,6EAAqD;AAMrD,kBAAe,KAAK,EAAE,IAAgB,EAAE,EAAE;IACxC,IAAI,MAAM,CAAC;IACX,IAAI;QACF,MAAM,GAAG,IAAI,CAAC,MAAM,IAAI,MAAM,IAAA,gBAAS,GAAE,CAAC;KAC3C;IAAC,OAAO,GAAG,EAAE;QACZ,sCAAsC;QACtC,OAAO,CAAC,GAAG,CAAC,GAAG,CAAC,CAAC;QACjB,OAAO,CAAC,IAAI,CAAC,CAAC,CAAC,CAAC;KACjB;IAED,MAAM,EAAE,UAAU,GAAG,GAAG,EAAE,GAAG,MAAM,CAAC;IAEpC,MAAM,GAAG,GAAG,IAAA,iBAAO,EAAC,IAAI,CAAC,CAAC;IAC1B,GAAG,CAAC,OAAO,CAAC,YAAY,EAAE,eAAK,CAAC,CAAC;IACjC,GAAG,CAAC,OAAO,CAAC,YAAY,EAAE,iBAAO,CAAC,CAAC;IACnC,GAAG,CAAC,OAAO,CAAC,YAAY,EAAE,cAAQ,CAAC,CAAC;IACpC,GAAG,CAAC,OAAO,CAAC,YAAY,EAAE,uBAAa,CAAC,CAAC;IAEzC,GAAG,CAAC,GAAG,CAAC,UAAU,EAAE,KAAK,IAAI,EAAE,CAAC,CAAC,EAAE,MAAM,EAAE,IAAI,EAAE,CAAC,CAAC,CAAC;IACpD,GAAG,CAAC,IAAI,CAAC,UAAU,EAAE,IAAI,EAAE,KAAK,IAAI,EAAE,CAAC,CAAC,EAAE,MAAM,EAAE,QAAQ,EAAE,CAAC,CAAC,CAAC;IAE/D,OAAO,GAAG,CAAC;AACb,CAAC,CAAC","sourcesContent":["import fastify, { FastifyServerOptions } from 'fastify';\nimport getConfig, { Config } from './config';\nimport debug from './services/debug';\nimport ubidots from './services/ubidots';\nimport httpHook from './services/http';\nimport homeAssistant from './services/homeassistant';\n\ninterface AppOptions extends FastifyServerOptions {\n  config?: Config;\n}\n\nexport default async (opts: AppOptions) => {\n  let config;\n  try {\n    config = opts.config || await getConfig();\n  } catch (err) {\n    // eslint-disable-next-line no-console\n    console.log(err);\n    process.exit(1);\n  }\n\n  const { serverPath = '/' } = config;\n\n  const app = fastify(opts);\n  app.addHook('onResponse', debug);\n  app.addHook('onResponse', ubidots);\n  app.addHook('onResponse', httpHook);\n  app.addHook('onResponse', homeAssistant);\n\n  app.get(serverPath, async () => ({ status: 'üç∫' }));\n  app.post(serverPath, opts, async () => ({ status: 'üç∫üç∫üç∫' }));\n\n  return app;\n};\n"]},"_coverageSchema":"1a1c01bbd47fc00a2c39e90264f33305004495a9","hash":"73f247788c90f4edf532e3828cdf1228f0527f7a","contentHash":"1927a4e8c38af4240a58ce0cae8671abaf2ff019f25b90074d49fbf63b101119"},"/Users/chris/Documents/projects/ispindel-multiservice/src/config.ts":{"path":"/Users/chris/Documents/projects/ispindel-multiservice/src/config.ts","statementMap":{"0":{"start":{"line":2,"column":22},"end":{"line":4,"column":1}},"1":{"start":{"line":3,"column":4},"end":{"line":3,"column":62}},"2":{"start":{"line":5,"column":0},"end":{"line":5,"column":62}},"3":{"start":{"line":6,"column":0},"end":{"line":6,"column":29}},"4":{"start":{"line":8,"column":17},"end":{"line":8,"column":51}},"5":{"start":{"line":10,"column":0},"end":{"line":14,"column":68}},"6":{"start":{"line":11,"column":4},"end":{"line":11,"column":56}},"7":{"start":{"line":12,"column":4},"end":{"line":12,"column":50}},"8":{"start":{"line":13,"column":4},"end":{"line":13,"column":70}},"9":{"start":{"line":15,"column":0},"end":{"line":19,"column":2}},"10":{"start":{"line":16,"column":19},"end":{"line":16,"column":89}},"11":{"start":{"line":17,"column":19},"end":{"line":17,"column":52}},"12":{"start":{"line":18,"column":4},"end":{"line":18,"column":18}}},"fnMap":{"0":{"name":"(anonymous_0)","decl":{"start":{"line":2,"column":56},"end":{"line":2,"column":57}},"loc":{"start":{"line":2,"column":71},"end":{"line":4,"column":1}},"line":2},"1":{"name":"(anonymous_1)","decl":{"start":{"line":10,"column":1},"end":{"line":10,"column":2}},"loc":{"start":{"line":10,"column":24},"end":{"line":14,"column":1}},"line":10},"2":{"name":"(anonymous_2)","decl":{"start":{"line":15,"column":18},"end":{"line":15,"column":19}},"loc":{"start":{"line":15,"column":74},"end":{"line":19,"column":1}},"line":15}},"branchMap":{"0":{"loc":{"start":{"line":2,"column":22},"end":{"line":4,"column":1}},"type":"binary-expr","locations":[{"start":{"line":2,"column":23},"end":{"line":2,"column":27}},{"start":{"line":2,"column":31},"end":{"line":2,"column":51}},{"start":{"line":2,"column":56},"end":{"line":4,"column":1}}],"line":2},"1":{"loc":{"start":{"line":3,"column":11},"end":{"line":3,"column":61}},"type":"cond-expr","locations":[{"start":{"line":3,"column":37},"end":{"line":3,"column":40}},{"start":{"line":3,"column":43},"end":{"line":3,"column":61}}],"line":3},"2":{"loc":{"start":{"line":3,"column":12},"end":{"line":3,"column":33}},"type":"binary-expr","locations":[{"start":{"line":3,"column":12},"end":{"line":3,"column":15}},{"start":{"line":3,"column":19},"end":{"line":3,"column":33}}],"line":3},"3":{"loc":{"start":{"line":14,"column":17},"end":{"line":14,"column":66}},"type":"binary-expr","locations":[{"start":{"line":14,"column":17},"end":{"line":14,"column":36}},{"start":{"line":14,"column":41},"end":{"line":14,"column":65}}],"line":14},"4":{"loc":{"start":{"line":15,"column":25},"end":{"line":15,"column":69}},"type":"default-arg","locations":[{"start":{"line":15,"column":40},"end":{"line":15,"column":69}}],"line":15}},"s":{"0":1,"1":1,"2":1,"3":1,"4":1,"5":1,"6":1,"7":1,"8":1,"9":1,"10":1,"11":1,"12":1},"f":{"0":1,"1":1,"2":1},"b":{"0":[1,1,1],"1":[0,1],"2":[1,1],"3":[1,1],"4":[0]},"inputSourceMap":{"version":3,"file":"/Users/chris/Documents/projects/ispindel-multiservice/src/config.ts","sources":["/Users/chris/Documents/projects/ispindel-multiservice/src/config.ts"],"names":[],"mappings":";;;;;;AAAA,kCAAkC;AAClC,oDAA4B;AAE5B,IAAY,WAIX;AAJD,WAAY,WAAW;IACrB,mDAAO,CAAA;IACP,6CAAI,CAAA;IACJ,iEAAc,CAAA;AAChB,CAAC,EAJW,WAAW,GAAX,mBAAW,KAAX,mBAAW,QAItB;AAsBD,kBAAe,KAAK,EAAE,YAAY,GAAG,GAAG,SAAS,iBAAiB,EAAmB,EAAE;IACrF,MAAM,MAAM,GAAiB,MAAM,IAAA,gBAAM,EAAC,EAAE,YAAY,EAAE,UAAU,EAAE,WAAW,EAAE,CAAC,CAAC;IACrF,MAAM,MAAM,GAAG,IAAI,CAAC,KAAK,CAAC,MAAM,CAAC,cAAc,CAAW,CAAC;IAC3D,OAAO,MAAM,CAAC;AAChB,CAAC,CAAC","sourcesContent":["/// <reference types=\"./envsub\" />\nimport envsub from 'envsub';\n\nexport enum ServiceType {\n  Ubidots,\n  HTTP,\n  HomeAssisstant,\n}\n\nexport interface Service {\n  type: ServiceType;\n  deviceLabel?: string;\n  token?: string;\n  url: string;\n  headers?: { [key: string]: string }\n}\n\nexport interface Config {\n  serverPath?: string;\n  services?: [Service];\n}\n\ninterface EnvsubResult {\n  templateFile: string;\n  templateContents: string;\n  outputFile: string;\n  outputContents: string;\n}\n\nexport default async (templateFile = `${__dirname}/../config.json`): Promise<Config> => {\n  const result: EnvsubResult = await envsub({ templateFile, outputFile: '/dev/null' });\n  const config = JSON.parse(result.outputContents) as Config;\n  return config;\n};\n"]},"_coverageSchema":"1a1c01bbd47fc00a2c39e90264f33305004495a9","hash":"3628456cefb79ab12a68ee389f0d38a356e4c3e6","contentHash":"0e60a84ecef19c638d892d53f1a8e8cd988c8a97e0397200fec9dc068289805f"},"/Users/chris/Documents/projects/ispindel-multiservice/src/services/debug.ts":{"path":"/Users/chris/Documents/projects/ispindel-multiservice/src/services/debug.ts","statementMap":{"0":{"start":{"line":2,"column":0},"end":{"line":2,"column":62}},"1":{"start":{"line":3,"column":0},"end":{"line":6,"column":2}},"2":{"start":{"line":4,"column":20},"end":{"line":4,"column":32}},"3":{"start":{"line":5,"column":4},"end":{"line":5,"column":62}}},"fnMap":{"0":{"name":"(anonymous_0)","decl":{"start":{"line":3,"column":18},"end":{"line":3,"column":19}},"loc":{"start":{"line":3,"column":37},"end":{"line":6,"column":1}},"line":3}},"branchMap":{},"s":{"0":1,"1":1,"2":1,"3":1},"f":{"0":1},"b":{},"inputSourceMap":{"version":3,"file":"/Users/chris/Documents/projects/ispindel-multiservice/src/services/debug.ts","sources":["/Users/chris/Documents/projects/ispindel-multiservice/src/services/debug.ts"],"names":[],"mappings":";;AAGA,kBAAe,KAAK,EAAE,OAAuB,EAAiB,EAAE;IAC9D,MAAM,OAAO,GAAiB,OAAO,CAAC,IAAoB,CAAC;IAE3D,OAAO,CAAC,GAAG,CAAC,KAAK,CAAC,OAAO,EAAE,6BAA6B,CAAC,CAAC;AAC5D,CAAC,CAAC","sourcesContent":["import { FastifyRequest } from 'fastify';\nimport { IspindelData } from '../index.d';\n\nexport default async (request: FastifyRequest): Promise<void> => {\n  const payload: IspindelData = request.body as IspindelData;\n\n  request.log.debug(payload, 'Received data from iSpindel');\n};\n"]},"_coverageSchema":"1a1c01bbd47fc00a2c39e90264f33305004495a9","hash":"4fd2429039935ecbf52a0cdd707ec2428badd8b5","contentHash":"8f3e3378aab54cb80be41abd7d37cda3d221e1caf700fcbdad6084484edcb274"},"/Users/chris/Documents/projects/ispindel-multiservice/src/services/ubidots.ts":{"path":"/Users/chris/Documents/projects/ispindel-multiservice/src/services/ubidots.ts","statementMap":{"0":{"start":{"line":2,"column":22},"end":{"line":4,"column":1}},"1":{"start":{"line":3,"column":4},"end":{"line":3,"column":62}},"2":{"start":{"line":5,"column":0},"end":{"line":5,"column":62}},"3":{"start":{"line":6,"column":16},"end":{"line":6,"column":49}},"4":{"start":{"line":7,"column":17},"end":{"line":7,"column":37}},"5":{"start":{"line":8,"column":22},"end":{"line":8,"column":64}},"6":{"start":{"line":9,"column":0},"end":{"line":40,"column":2}},"7":{"start":{"line":10,"column":21},"end":{"line":10,"column":92}},"8":{"start":{"line":11,"column":4},"end":{"line":13,"column":5}},"9":{"start":{"line":12,"column":8},"end":{"line":12,"column":15}},"10":{"start":{"line":14,"column":17},"end":{"line":14,"column":29}},"11":{"start":{"line":15,"column":63},"end":{"line":15,"column":67}},"12":{"start":{"line":16,"column":20},"end":{"line":23,"column":5}},"13":{"start":{"line":24,"column":4},"end":{"line":39,"column":7}},"14":{"start":{"line":25,"column":57},"end":{"line":25,"column":64}},"15":{"start":{"line":26,"column":8},"end":{"line":29,"column":9}},"16":{"start":{"line":27,"column":12},"end":{"line":27,"column":124}},"17":{"start":{"line":28,"column":12},"end":{"line":28,"column":19}},"18":{"start":{"line":30,"column":8},"end":{"line":38,"column":9}},"19":{"start":{"line":31,"column":12},"end":{"line":31,"column":75}},"20":{"start":{"line":32,"column":12},"end":{"line":34,"column":15}},"21":{"start":{"line":37,"column":12},"end":{"line":37,"column":71}}},"fnMap":{"0":{"name":"(anonymous_0)","decl":{"start":{"line":2,"column":56},"end":{"line":2,"column":57}},"loc":{"start":{"line":2,"column":71},"end":{"line":4,"column":1}},"line":2},"1":{"name":"(anonymous_1)","decl":{"start":{"line":9,"column":18},"end":{"line":9,"column":19}},"loc":{"start":{"line":9,"column":37},"end":{"line":40,"column":1}},"line":9},"2":{"name":"(anonymous_2)","decl":{"start":{"line":24,"column":21},"end":{"line":24,"column":22}},"loc":{"start":{"line":24,"column":40},"end":{"line":39,"column":5}},"line":24}},"branchMap":{"0":{"loc":{"start":{"line":2,"column":22},"end":{"line":4,"column":1}},"type":"binary-expr","locations":[{"start":{"line":2,"column":23},"end":{"line":2,"column":27}},{"start":{"line":2,"column":31},"end":{"line":2,"column":51}},{"start":{"line":2,"column":56},"end":{"line":4,"column":1}}],"line":2},"1":{"loc":{"start":{"line":3,"column":11},"end":{"line":3,"column":61}},"type":"cond-expr","locations":[{"start":{"line":3,"column":37},"end":{"line":3,"column":40}},{"start":{"line":3,"column":43},"end":{"line":3,"column":61}}],"line":3},"2":{"loc":{"start":{"line":3,"column":12},"end":{"line":3,"column":33}},"type":"binary-expr","locations":[{"start":{"line":3,"column":12},"end":{"line":3,"column":15}},{"start":{"line":3,"column":19},"end":{"line":3,"column":33}}],"line":3},"3":{"loc":{"start":{"line":11,"column":4},"end":{"line":13,"column":5}},"type":"if","locations":[{"start":{"line":11,"column":4},"end":{"line":13,"column":5}},{"start":{"line":11,"column":4},"end":{"line":13,"column":5}}],"line":11},"4":{"loc":{"start":{"line":25,"column":29},"end":{"line":25,"column":45}},"type":"default-arg","locations":[{"start":{"line":25,"column":36},"end":{"line":25,"column":45}}],"line":25},"5":{"loc":{"start":{"line":26,"column":8},"end":{"line":29,"column":9}},"type":"if","locations":[{"start":{"line":26,"column":8},"end":{"line":29,"column":9}},{"start":{"line":26,"column":8},"end":{"line":29,"column":9}}],"line":26}},"s":{"0":1,"1":2,"2":1,"3":1,"4":1,"5":1,"6":1,"7":1,"8":1,"9":1,"10":0,"11":0,"12":0,"13":0,"14":0,"15":0,"16":0,"17":0,"18":0,"19":0,"20":0,"21":0},"f":{"0":2,"1":1,"2":0},"b":{"0":[1,1,1],"1":[1,1],"2":[2,2],"3":[1,0],"4":[0],"5":[0,0]},"inputSourceMap":{"version":3,"file":"/Users/chris/Documents/projects/ispindel-multiservice/src/services/ubidots.ts","sources":["/Users/chris/Documents/projects/ispindel-multiservice/src/services/ubidots.ts"],"names":[],"mappings":";;;;;AACA,kDAA0B;AAC1B,sCAAwC;AACxC,iEAAyC;AAYzC,kBAAe,KAAK,EAAE,OAAuB,EAAiB,EAAE;IAC9D,MAAM,QAAQ,GAAG,MAAM,IAAA,qBAAW,EAAC,OAAO,EAAE,oBAAW,CAAC,OAAO,CAAC,CAAC;IACjE,IAAI,CAAC,QAAQ,EAAE;QACb,OAAO;KACR;IAED,MAAM,IAAI,GAAiB,OAAO,CAAC,IAAoB,CAAC;IAExD,MAAM,EACJ,WAAW,EACX,OAAO,EACP,OAAO,EACP,QAAQ,EACR,IAAI,GACL,GAAG,IAAI,CAAC;IAET,MAAM,OAAO,GAAgB;QAC3B,IAAI,EAAE,IAAI,CAAC,KAAK;QAChB,WAAW;QACX,OAAO;QACP,OAAO;QACP,QAAQ;QACR,IAAI;KACL,CAAC;IAEF,QAAQ,CAAC,OAAO,CAAC,KAAK,EAAE,OAAO,EAAE,EAAE;QACjC,MAAM,EAAE,WAAW,EAAE,IAAI,GAAG,IAAI,CAAC,IAAI,EAAE,KAAK,EAAE,GAAG,OAAO,CAAC;QAEzD,IAAI,CAAC,KAAK,EAAE;YACV,OAAO,CAAC,GAAG,CAAC,KAAK,CAAC,uBAAuB,IAAI,iEAAiE,CAAC,CAAC;YAChH,OAAO;SACR;QAED,IAAI;YACF,OAAO,CAAC,GAAG,CAAC,IAAI,CAAC,sCAAsC,IAAI,EAAE,CAAC,CAAC;YAC/D,MAAM,eAAK,CAAC,IAAI,CACd,+CAA+C,IAAI,EAAE,EACrD,OAAO,EACP;gBACE,OAAO,EAAE,EAAE,cAAc,EAAE,KAAK,EAAE;aACnC,CACF,CAAC;SACH;QAAC,OAAO,GAAG,EAAE;YACZ,OAAO,CAAC,GAAG,CAAC,KAAK,CAAC,GAAG,EAAE,4BAA4B,IAAI,EAAE,CAAC,CAAC;SAC5D;IACH,CAAC,CAAC,CAAC;AACL,CAAC,CAAC","sourcesContent":["import { FastifyRequest } from 'fastify';\nimport axios from 'axios';\nimport { ServiceType } from '../config';\nimport getServices from '../getServices';\nimport { IspindelData } from '../index.d';\n\ninterface UbiDotsData {\n  tilt: number;\n  temperature: number;\n  battery: number;\n  gravity: number;\n  interval: number;\n  RSSI: number;\n}\n\nexport default async (request: FastifyRequest): Promise<void> => {\n  const services = await getServices(request, ServiceType.Ubidots);\n  if (!services) {\n    return;\n  }\n\n  const data: IspindelData = request.body as IspindelData;\n\n  const {\n    temperature,\n    battery,\n    gravity,\n    interval,\n    RSSI,\n  } = data;\n\n  const payload: UbiDotsData = {\n    tilt: data.angle,\n    temperature,\n    battery,\n    gravity,\n    interval,\n    RSSI,\n  };\n\n  services.forEach(async (service) => {\n    const { deviceLabel: name = data.name, token } = service;\n\n    if (!token) {\n      request.log.error(`Ubidots service for ${name} does not have a token in config.json or env. Skipping service.`);\n      return;\n    }\n\n    try {\n      request.log.info(`Sending data to Ubidots for device ${name}`);\n      await axios.post(\n        `https://things.ubidots.com/api/v1.6/devices/${name}`,\n        payload,\n        {\n          headers: { 'X-Auth-Token': token },\n        },\n      );\n    } catch (err) {\n      request.log.error(err, `Ubidots error for device ${name}`);\n    }\n  });\n};\n"]},"_coverageSchema":"1a1c01bbd47fc00a2c39e90264f33305004495a9","hash":"98a6b35d604c41441d51d3595ca13ae4847cbd46","contentHash":"3a6c365c43142a1d9bca89d42ce7905de03e2aa9196fa30272b00392c5069fd2"},"/Users/chris/Documents/projects/ispindel-multiservice/src/getServices.ts":{"path":"/Users/chris/Documents/projects/ispindel-multiservice/src/getServices.ts","statementMap":{"0":{"start":{"line":2,"column":22},"end":{"line":4,"column":1}},"1":{"start":{"line":3,"column":4},"end":{"line":3,"column":62}},"2":{"start":{"line":5,"column":0},"end":{"line":5,"column":62}},"3":{"start":{"line":6,"column":17},"end":{"line":6,"column":53}},"4":{"start":{"line":7,"column":0},"end":{"line":20,"column":2}},"5":{"start":{"line":8,"column":4},"end":{"line":10,"column":5}},"6":{"start":{"line":9,"column":8},"end":{"line":9,"column":25}},"7":{"start":{"line":11,"column":19},"end":{"line":11,"column":48}},"8":{"start":{"line":12,"column":4},"end":{"line":14,"column":5}},"9":{"start":{"line":13,"column":8},"end":{"line":13,"column":25}},"10":{"start":{"line":15,"column":21},"end":{"line":15,"column":86}},"11":{"start":{"line":15,"column":57},"end":{"line":15,"column":85}},"12":{"start":{"line":16,"column":4},"end":{"line":18,"column":5}},"13":{"start":{"line":17,"column":8},"end":{"line":17,"column":25}},"14":{"start":{"line":19,"column":4},"end":{"line":19,"column":20}}},"fnMap":{"0":{"name":"(anonymous_0)","decl":{"start":{"line":2,"column":56},"end":{"line":2,"column":57}},"loc":{"start":{"line":2,"column":71},"end":{"line":4,"column":1}},"line":2},"1":{"name":"(anonymous_1)","decl":{"start":{"line":7,"column":18},"end":{"line":7,"column":19}},"loc":{"start":{"line":7,"column":50},"end":{"line":20,"column":1}},"line":7},"2":{"name":"(anonymous_2)","decl":{"start":{"line":15,"column":44},"end":{"line":15,"column":45}},"loc":{"start":{"line":15,"column":57},"end":{"line":15,"column":85}},"line":15}},"branchMap":{"0":{"loc":{"start":{"line":2,"column":22},"end":{"line":4,"column":1}},"type":"binary-expr","locations":[{"start":{"line":2,"column":23},"end":{"line":2,"column":27}},{"start":{"line":2,"column":31},"end":{"line":2,"column":51}},{"start":{"line":2,"column":56},"end":{"line":4,"column":1}}],"line":2},"1":{"loc":{"start":{"line":3,"column":11},"end":{"line":3,"column":61}},"type":"cond-expr","locations":[{"start":{"line":3,"column":37},"end":{"line":3,"column":40}},{"start":{"line":3,"column":43},"end":{"line":3,"column":61}}],"line":3},"2":{"loc":{"start":{"line":3,"column":12},"end":{"line":3,"column":33}},"type":"binary-expr","locations":[{"start":{"line":3,"column":12},"end":{"line":3,"column":15}},{"start":{"line":3,"column":19},"end":{"line":3,"column":33}}],"line":3},"3":{"loc":{"start":{"line":8,"column":4},"end":{"line":10,"column":5}},"type":"if","locations":[{"start":{"line":8,"column":4},"end":{"line":10,"column":5}},{"start":{"line":8,"column":4},"end":{"line":10,"column":5}}],"line":8},"4":{"loc":{"start":{"line":8,"column":8},"end":{"line":8,"column":49}},"type":"binary-expr","locations":[{"start":{"line":8,"column":8},"end":{"line":8,"column":21}},{"start":{"line":8,"column":25},"end":{"line":8,"column":49}}],"line":8},"5":{"loc":{"start":{"line":12,"column":4},"end":{"line":14,"column":5}},"type":"if","locations":[{"start":{"line":12,"column":4},"end":{"line":14,"column":5}},{"start":{"line":12,"column":4},"end":{"line":14,"column":5}}],"line":12},"6":{"loc":{"start":{"line":12,"column":8},"end":{"line":12,"column":51}},"type":"binary-expr","locations":[{"start":{"line":12,"column":8},"end":{"line":12,"column":31}},{"start":{"line":12,"column":35},"end":{"line":12,"column":51}}],"line":12},"7":{"loc":{"start":{"line":16,"column":4},"end":{"line":18,"column":5}},"type":"if","locations":[{"start":{"line":16,"column":4},"end":{"line":18,"column":5}},{"start":{"line":16,"column":4},"end":{"line":18,"column":5}}],"line":16}},"s":{"0":1,"1":1,"2":1,"3":1,"4":1,"5":3,"6":3,"7":0,"8":0,"9":0,"10":0,"11":0,"12":0,"13":0,"14":0},"f":{"0":1,"1":3,"2":0},"b":{"0":[1,1,1],"1":[1,0],"2":[1,1],"3":[3,0],"4":[3,3],"5":[0,0],"6":[0,0],"7":[0,0]},"inputSourceMap":{"version":3,"file":"/Users/chris/Documents/projects/ispindel-multiservice/src/getServices.ts","sources":["/Users/chris/Documents/projects/ispindel-multiservice/src/getServices.ts"],"names":[],"mappings":";;;;;AACA,sDAA2D;AAE3D,kBAAe,KAAK,EAClB,OAAuB,EACvB,WAAwB,EACQ,EAAE;IAClC,IAAI,OAAO,CAAC,KAAK,IAAI,OAAO,CAAC,MAAM,KAAK,KAAK,EAAE;QAC7C,OAAO,SAAS,CAAC;KAClB;IAED,MAAM,MAAM,GAAG,MAAM,IAAA,gBAAS,GAAE,CAAC;IACjC,IAAI,MAAM,YAAY,KAAK,IAAI,CAAC,MAAM,CAAC,QAAQ,EAAE;QAC/C,OAAO,SAAS,CAAC;KAClB;IAED,MAAM,QAAQ,GAAG,MAAM,CAAC,QAAQ,CAAC,MAAM,CAAC,CAAC,OAAO,EAAE,EAAE,CAAC,OAAO,CAAC,IAAI,KAAK,WAAW,CAAC,CAAC;IACnF,IAAI,QAAQ,CAAC,MAAM,KAAK,CAAC,EAAE;QACzB,OAAO,SAAS,CAAC;KAClB;IACD,OAAO,QAAQ,CAAC;AAClB,CAAC,CAAC","sourcesContent":["import { FastifyRequest } from 'fastify';\nimport getConfig, { Service, ServiceType } from './config';\n\nexport default async (\n  request: FastifyRequest,\n  serviceType: ServiceType,\n): Promise<Service[] | undefined> => {\n  if (request.is404 || request.method === 'GET') {\n    return undefined;\n  }\n\n  const config = await getConfig();\n  if (config instanceof Error || !config.services) {\n    return undefined;\n  }\n\n  const services = config.services.filter((service) => service.type === serviceType);\n  if (services.length === 0) {\n    return undefined;\n  }\n  return services;\n};\n"]},"_coverageSchema":"1a1c01bbd47fc00a2c39e90264f33305004495a9","hash":"476f1758668fb48b355b1ff50a2b4f392532cb54","contentHash":"90f8a154310c9f680d1edb2351f13e8bc06c8e22bf881d232c87fe842eb2f292"},"/Users/chris/Documents/projects/ispindel-multiservice/src/services/http.ts":{"path":"/Users/chris/Documents/projects/ispindel-multiservice/src/services/http.ts","statementMap":{"0":{"start":{"line":2,"column":22},"end":{"line":4,"column":1}},"1":{"start":{"line":3,"column":4},"end":{"line":3,"column":62}},"2":{"start":{"line":5,"column":0},"end":{"line":5,"column":62}},"3":{"start":{"line":6,"column":16},"end":{"line":6,"column":49}},"4":{"start":{"line":7,"column":22},"end":{"line":7,"column":64}},"5":{"start":{"line":8,"column":17},"end":{"line":8,"column":37}},"6":{"start":{"line":9,"column":0},"end":{"line":36,"column":2}},"7":{"start":{"line":10,"column":21},"end":{"line":10,"column":89}},"8":{"start":{"line":11,"column":4},"end":{"line":13,"column":5}},"9":{"start":{"line":12,"column":8},"end":{"line":12,"column":15}},"10":{"start":{"line":14,"column":20},"end":{"line":14,"column":32}},"11":{"start":{"line":15,"column":4},"end":{"line":35,"column":7}},"12":{"start":{"line":16,"column":79},"end":{"line":16,"column":86}},"13":{"start":{"line":17,"column":28},"end":{"line":17,"column":30}},"14":{"start":{"line":18,"column":8},"end":{"line":21,"column":9}},"15":{"start":{"line":19,"column":12},"end":{"line":19,"column":88}},"16":{"start":{"line":20,"column":12},"end":{"line":20,"column":19}},"17":{"start":{"line":22,"column":8},"end":{"line":22,"column":28}},"18":{"start":{"line":23,"column":8},"end":{"line":25,"column":9}},"19":{"start":{"line":24,"column":12},"end":{"line":24,"column":42}},"20":{"start":{"line":26,"column":8},"end":{"line":34,"column":9}},"21":{"start":{"line":27,"column":12},"end":{"line":27,"column":75}},"22":{"start":{"line":28,"column":46},"end":{"line":28,"column":99}},"23":{"start":{"line":30,"column":12},"end":{"line":30,"column":72}},"24":{"start":{"line":33,"column":12},"end":{"line":33,"column":80}}},"fnMap":{"0":{"name":"(anonymous_0)","decl":{"start":{"line":2,"column":56},"end":{"line":2,"column":57}},"loc":{"start":{"line":2,"column":71},"end":{"line":4,"column":1}},"line":2},"1":{"name":"(anonymous_1)","decl":{"start":{"line":9,"column":18},"end":{"line":9,"column":19}},"loc":{"start":{"line":9,"column":37},"end":{"line":36,"column":1}},"line":9},"2":{"name":"(anonymous_2)","decl":{"start":{"line":15,"column":21},"end":{"line":15,"column":22}},"loc":{"start":{"line":15,"column":40},"end":{"line":35,"column":5}},"line":15}},"branchMap":{"0":{"loc":{"start":{"line":2,"column":22},"end":{"line":4,"column":1}},"type":"binary-expr","locations":[{"start":{"line":2,"column":23},"end":{"line":2,"column":27}},{"start":{"line":2,"column":31},"end":{"line":2,"column":51}},{"start":{"line":2,"column":56},"end":{"line":4,"column":1}}],"line":2},"1":{"loc":{"start":{"line":3,"column":11},"end":{"line":3,"column":61}},"type":"cond-expr","locations":[{"start":{"line":3,"column":37},"end":{"line":3,"column":40}},{"start":{"line":3,"column":43},"end":{"line":3,"column":61}}],"line":3},"2":{"loc":{"start":{"line":3,"column":12},"end":{"line":3,"column":33}},"type":"binary-expr","locations":[{"start":{"line":3,"column":12},"end":{"line":3,"column":15}},{"start":{"line":3,"column":19},"end":{"line":3,"column":33}}],"line":3},"3":{"loc":{"start":{"line":11,"column":4},"end":{"line":13,"column":5}},"type":"if","locations":[{"start":{"line":11,"column":4},"end":{"line":13,"column":5}},{"start":{"line":11,"column":4},"end":{"line":13,"column":5}}],"line":11},"4":{"loc":{"start":{"line":16,"column":29},"end":{"line":16,"column":48}},"type":"default-arg","locations":[{"start":{"line":16,"column":36},"end":{"line":16,"column":48}}],"line":16},"5":{"loc":{"start":{"line":16,"column":55},"end":{"line":16,"column":74}},"type":"default-arg","locations":[{"start":{"line":16,"column":65},"end":{"line":16,"column":74}}],"line":16},"6":{"loc":{"start":{"line":18,"column":8},"end":{"line":21,"column":9}},"type":"if","locations":[{"start":{"line":18,"column":8},"end":{"line":21,"column":9}},{"start":{"line":18,"column":8},"end":{"line":21,"column":9}}],"line":18},"7":{"loc":{"start":{"line":23,"column":8},"end":{"line":25,"column":9}},"type":"if","locations":[{"start":{"line":23,"column":8},"end":{"line":25,"column":9}},{"start":{"line":23,"column":8},"end":{"line":25,"column":9}}],"line":23}},"s":{"0":1,"1":2,"2":1,"3":1,"4":1,"5":1,"6":1,"7":1,"8":1,"9":1,"10":0,"11":0,"12":0,"13":0,"14":0,"15":0,"16":0,"17":0,"18":0,"19":0,"20":0,"21":0,"22":0,"23":0,"24":0},"f":{"0":2,"1":1,"2":0},"b":{"0":[1,1,1],"1":[1,1],"2":[2,2],"3":[1,0],"4":[0],"5":[0],"6":[0,0],"7":[0,0]},"inputSourceMap":{"version":3,"file":"/Users/chris/Documents/projects/ispindel-multiservice/src/services/http.ts","sources":["/Users/chris/Documents/projects/ispindel-multiservice/src/services/http.ts"],"names":[],"mappings":";;;;;AACA,kDAAkD;AAClD,iEAAyC;AAEzC,sCAAwC;AAExC,kBAAe,KAAK,EAAE,OAAuB,EAAiB,EAAE;IAC9D,MAAM,QAAQ,GAAG,MAAM,IAAA,qBAAW,EAAC,OAAO,EAAE,oBAAW,CAAC,IAAI,CAAC,CAAC;IAC9D,IAAI,CAAC,QAAQ,EAAE;QACb,OAAO;KACR;IAED,MAAM,OAAO,GAAiB,OAAO,CAAC,IAAoB,CAAC;IAE3D,QAAQ,CAAC,OAAO,CAAC,KAAK,EAAE,OAAO,EAAE,EAAE;QACjC,MAAM,EAAE,WAAW,EAAE,IAAI,GAAG,OAAO,CAAC,IAAI,EAAE,GAAG,EAAE,OAAO,GAAG,SAAS,EAAE,GAAG,OAAO,CAAC;QAC/E,MAAM,WAAW,GAAuB,EAAE,CAAC;QAC3C,IAAI,CAAC,GAAG,EAAE;YACR,OAAO,CAAC,GAAG,CAAC,KAAK,CAAC,kCAAkC,IAAI,kBAAkB,CAAC,CAAC;YAC5E,OAAO;SACR;QAED,OAAO,CAAC,IAAI,GAAG,IAAI,CAAC;QACpB,IAAI,OAAO,EAAE;YACX,WAAW,CAAC,OAAO,GAAG,OAAO,CAAC;SAC/B;QAED,IAAI;YACF,OAAO,CAAC,GAAG,CAAC,IAAI,CAAC,mBAAmB,GAAG,eAAe,IAAI,GAAG,CAAC,CAAC;YAC/D,MAAM,EAAE,MAAM,EAAE,IAAI,EAAE,OAAO,EAAE,GAAG,MAAM,eAAK,CAAC,IAAI,CAChD,GAAG,EACH,OAAO,EACP,WAAW,CACZ,CAAC;YACF,sCAAsC;YACtC,OAAO,CAAC,GAAG,CAAC,IAAI,CAAC,OAAO,EAAE,GAAG,MAAM,kBAAkB,GAAG,EAAE,CAAC,CAAC;SAC7D;QAAC,OAAO,GAAG,EAAE;YACZ,OAAO,CAAC,GAAG,CAAC,KAAK,CAAC,GAAG,EAAE,mBAAmB,GAAG,eAAe,IAAI,EAAE,CAAC,CAAC;SACrE;IACH,CAAC,CAAC,CAAC;AACL,CAAC,CAAC","sourcesContent":["import { FastifyRequest } from 'fastify';\nimport axios, { AxiosRequestConfig } from 'axios';\nimport getServices from '../getServices';\nimport { IspindelData } from '../index.d';\nimport { ServiceType } from '../config';\n\nexport default async (request: FastifyRequest): Promise<void> => {\n  const services = await getServices(request, ServiceType.HTTP);\n  if (!services) {\n    return;\n  }\n\n  const payload: IspindelData = request.body as IspindelData;\n\n  services.forEach(async (service) => {\n    const { deviceLabel: name = payload.name, url, headers = undefined } = service;\n    const axiosConfig: AxiosRequestConfig = {};\n    if (!url) {\n      request.log.error(`'url' not set for http service ${name}. Data not sent.`);\n      return;\n    }\n\n    payload.name = name;\n    if (headers) {\n      axiosConfig.headers = headers;\n    }\n\n    try {\n      request.log.info(`Sending data to ${url} for device ${name} `);\n      const { status, data: resData } = await axios.post(\n        url,\n        payload,\n        axiosConfig,\n      );\n      // eslint-disable-next-line no-console\n      request.log.info(resData, `${status} response from ${url}`);\n    } catch (err) {\n      request.log.error(err, `http error from ${url} for device ${name}`);\n    }\n  });\n};\n"]},"_coverageSchema":"1a1c01bbd47fc00a2c39e90264f33305004495a9","hash":"2f516afa3bd1133c07dc669a19104440649e373e","contentHash":"8df4c4973bb05b0cf84e1e34da083fbbb001d03238d61faa729f85a54f7839e8"},"/Users/chris/Documents/projects/ispindel-multiservice/src/services/homeassistant.ts":{"path":"/Users/chris/Documents/projects/ispindel-multiservice/src/services/homeassistant.ts","statementMap":{"0":{"start":{"line":2,"column":22},"end":{"line":4,"column":1}},"1":{"start":{"line":3,"column":4},"end":{"line":3,"column":62}},"2":{"start":{"line":5,"column":0},"end":{"line":5,"column":62}},"3":{"start":{"line":6,"column":16},"end":{"line":6,"column":49}},"4":{"start":{"line":7,"column":17},"end":{"line":7,"column":37}},"5":{"start":{"line":8,"column":22},"end":{"line":8,"column":64}},"6":{"start":{"line":9,"column":0},"end":{"line":45,"column":2}},"7":{"start":{"line":10,"column":21},"end":{"line":10,"column":99}},"8":{"start":{"line":11,"column":4},"end":{"line":13,"column":5}},"9":{"start":{"line":12,"column":8},"end":{"line":12,"column":15}},"10":{"start":{"line":14,"column":17},"end":{"line":14,"column":29}},"11":{"start":{"line":15,"column":21},"end":{"line":32,"column":5}},"12":{"start":{"line":16,"column":24},"end":{"line":22,"column":9}},"13":{"start":{"line":23,"column":8},"end":{"line":23,"column":118}},"14":{"start":{"line":24,"column":8},"end":{"line":31,"column":9}},"15":{"start":{"line":25,"column":46},"end":{"line":25,"column":235}},"16":{"start":{"line":27,"column":12},"end":{"line":27,"column":72}},"17":{"start":{"line":30,"column":12},"end":{"line":30,"column":92}},"18":{"start":{"line":33,"column":4},"end":{"line":44,"column":7}},"19":{"start":{"line":34,"column":56},"end":{"line":34,"column":63}},"20":{"start":{"line":35,"column":28},"end":{"line":35,"column":30}},"21":{"start":{"line":36,"column":8},"end":{"line":38,"column":9}},"22":{"start":{"line":37,"column":12},"end":{"line":37,"column":104}},"23":{"start":{"line":39,"column":58},"end":{"line":39,"column":62}},"24":{"start":{"line":40,"column":8},"end":{"line":40,"column":89}},"25":{"start":{"line":41,"column":8},"end":{"line":41,"column":84}},"26":{"start":{"line":42,"column":8},"end":{"line":42,"column":81}},"27":{"start":{"line":43,"column":8},"end":{"line":43,"column":82}}},"fnMap":{"0":{"name":"(anonymous_0)","decl":{"start":{"line":2,"column":56},"end":{"line":2,"column":57}},"loc":{"start":{"line":2,"column":71},"end":{"line":4,"column":1}},"line":2},"1":{"name":"(anonymous_1)","decl":{"start":{"line":9,"column":18},"end":{"line":9,"column":19}},"loc":{"start":{"line":9,"column":37},"end":{"line":45,"column":1}},"line":9},"2":{"name":"(anonymous_2)","decl":{"start":{"line":15,"column":21},"end":{"line":15,"column":22}},"loc":{"start":{"line":15,"column":106},"end":{"line":32,"column":5}},"line":15},"3":{"name":"(anonymous_3)","decl":{"start":{"line":33,"column":21},"end":{"line":33,"column":22}},"loc":{"start":{"line":33,"column":40},"end":{"line":44,"column":5}},"line":33}},"branchMap":{"0":{"loc":{"start":{"line":2,"column":22},"end":{"line":4,"column":1}},"type":"binary-expr","locations":[{"start":{"line":2,"column":23},"end":{"line":2,"column":27}},{"start":{"line":2,"column":31},"end":{"line":2,"column":51}},{"start":{"line":2,"column":56},"end":{"line":4,"column":1}}],"line":2},"1":{"loc":{"start":{"line":3,"column":11},"end":{"line":3,"column":61}},"type":"cond-expr","locations":[{"start":{"line":3,"column":37},"end":{"line":3,"column":40}},{"start":{"line":3,"column":43},"end":{"line":3,"column":61}}],"line":3},"2":{"loc":{"start":{"line":3,"column":12},"end":{"line":3,"column":33}},"type":"binary-expr","locations":[{"start":{"line":3,"column":12},"end":{"line":3,"column":15}},{"start":{"line":3,"column":19},"end":{"line":3,"column":33}}],"line":3},"3":{"loc":{"start":{"line":11,"column":4},"end":{"line":13,"column":5}},"type":"if","locations":[{"start":{"line":11,"column":4},"end":{"line":13,"column":5}},{"start":{"line":11,"column":4},"end":{"line":13,"column":5}}],"line":11},"4":{"loc":{"start":{"line":34,"column":16},"end":{"line":34,"column":39}},"type":"default-arg","locations":[{"start":{"line":34,"column":30},"end":{"line":34,"column":39}}],"line":34},"5":{"loc":{"start":{"line":36,"column":8},"end":{"line":38,"column":9}},"type":"if","locations":[{"start":{"line":36,"column":8},"end":{"line":38,"column":9}},{"start":{"line":36,"column":8},"end":{"line":38,"column":9}}],"line":36}},"s":{"0":1,"1":2,"2":1,"3":1,"4":1,"5":1,"6":1,"7":1,"8":1,"9":1,"10":0,"11":0,"12":0,"13":0,"14":0,"15":0,"16":0,"17":0,"18":0,"19":0,"20":0,"21":0,"22":0,"23":0,"24":0,"25":0,"26":0,"27":0},"f":{"0":2,"1":1,"2":0,"3":0},"b":{"0":[1,1,1],"1":[1,1],"2":[2,2],"3":[1,0],"4":[0],"5":[0,0]},"inputSourceMap":{"version":3,"file":"/Users/chris/Documents/projects/ispindel-multiservice/src/services/homeassistant.ts","sources":["/Users/chris/Documents/projects/ispindel-multiservice/src/services/homeassistant.ts"],"names":[],"mappings":";;;;;AACA,kDAAkD;AAClD,sCAAwC;AACxC,iEAAyC;AAIzC,kBAAe,KAAK,EAAE,OAAuB,EAAiB,EAAE;IAC9D,MAAM,QAAQ,GAAG,MAAM,IAAA,qBAAW,EAAC,OAAO,EAAE,oBAAW,CAAC,cAAc,CAAC,CAAC;IACxE,IAAI,CAAC,QAAQ,EAAE;QACb,OAAO;KACR;IAED,MAAM,IAAI,GAAiB,OAAO,CAAC,IAAoB,CAAC;IAExD,MAAM,QAAQ,GAAG,KAAK,EACpB,GAAuB,EACvB,WAAmB,EACnB,SAAiB,EACjB,KAAc,EACd,iBAAyB,EACzB,KAAyB,EACzB,WAA+B,EAC/B,EAAE;QACF,MAAM,OAAO,GAAG;YACd,KAAK;YACL,UAAU,EAAE;gBACV,mBAAmB,EAAE,iBAAiB;gBACtC,aAAa,EAAE,GAAG,WAAW,IAAI,SAAS,EAAE;aAC7C;SACF,CAAC;QAEF,OAAO,CAAC,GAAG,CAAC,IAAI,CAAC,oCAAoC,GAAG,eAAe,WAAW,cAAc,SAAS,GAAG,CAAC,CAAC;QAC9G,IAAI;YACF,MAAM,EAAE,MAAM,EAAE,IAAI,EAAE,OAAO,EAAE,GAAG,MAAM,eAAK,CAAC,IAAI,CAChD,GAAG,GAAG,sBAAsB,WAAW,IAAI,SAAS,EAAE,EACtD,OAAO,kCAEF,WAAW,KACd,OAAO,EAAE,EAAE,aAAa,EAAE,UAAU,KAAK,EAAE,EAAE,IAEhD,CAAC;YACF,sCAAsC;YACtC,OAAO,CAAC,GAAG,CAAC,IAAI,CAAC,OAAO,EAAE,GAAG,MAAM,kBAAkB,GAAG,EAAE,CAAC,CAAC;SAC7D;QAAC,OAAO,GAAG,EAAE;YACZ,OAAO,CAAC,GAAG,CAAC,KAAK,CAAC,GAAG,EAAE,+BAA+B,GAAG,eAAe,IAAI,EAAE,CAAC,CAAC;SACjF;IACH,CAAC,CAAC;IAEF,QAAQ,CAAC,OAAO,CAAC,KAAK,EAAE,OAAO,EAAE,EAAE;QACjC,MAAM,EAAE,WAAW,GAAG,IAAI,CAAC,IAAI,EAAE,GAAG,EAAE,KAAK,EAAE,GAAG,OAAO,CAAC;QACxD,MAAM,WAAW,GAAuB,EAAE,CAAC;QAC3C,IAAI,CAAC,GAAG,EAAE;YACR,OAAO,CAAC,GAAG,CAAC,KAAK,CAAC,2CAA2C,WAAW,kBAAkB,CAAC,CAAC;SAC7F;QAED,MAAM,EACJ,WAAW,EACX,OAAO,EACP,OAAO,EACP,KAAK,GACN,GAAG,IAAI,CAAC;QAET,QAAQ,CAAC,GAAG,EAAE,WAAW,EAAE,aAAa,EAAE,WAAW,EAAE,IAAI,EAAE,KAAK,EAAE,WAAW,CAAC,CAAC;QACjF,QAAQ,CAAC,GAAG,EAAE,WAAW,EAAE,SAAS,EAAE,OAAO,EAAE,OAAO,EAAE,KAAK,EAAE,WAAW,CAAC,CAAC;QAC5E,QAAQ,CAAC,GAAG,EAAE,WAAW,EAAE,SAAS,EAAE,OAAO,EAAE,IAAI,EAAE,KAAK,EAAE,WAAW,CAAC,CAAC;QACzE,QAAQ,CAAC,GAAG,EAAE,WAAW,EAAE,OAAO,EAAE,KAAK,EAAE,SAAS,EAAE,KAAK,EAAE,WAAW,CAAC,CAAC;IAC5E,CAAC,CAAC,CAAC;AACL,CAAC,CAAC","sourcesContent":["import { FastifyRequest } from 'fastify';\nimport axios, { AxiosRequestConfig } from 'axios';\nimport { ServiceType } from '../config';\nimport getServices from '../getServices';\n\nimport { IspindelData } from '../index.d';\n\nexport default async (request: FastifyRequest): Promise<void> => {\n  const services = await getServices(request, ServiceType.HomeAssisstant);\n  if (!services) {\n    return;\n  }\n\n  const data: IspindelData = request.body as IspindelData;\n\n  const postData = async (\n    url: string | undefined,\n    deviceLabel: string,\n    stateName: string,\n    state: unknown,\n    unitOfMeasurement: string,\n    token: string | undefined,\n    axiosConfig: AxiosRequestConfig,\n  ) => {\n    const payload = {\n      state,\n      attributes: {\n        unit_of_measurement: unitOfMeasurement,\n        friendly_name: `${deviceLabel} ${stateName}`,\n      },\n    };\n\n    request.log.info(`Sending data to homeassistant at ${url} for device ${deviceLabel} for state ${stateName} `);\n    try {\n      const { status, data: resData } = await axios.post(\n        `${url}/api/states/sensor.${deviceLabel}_${stateName}`,\n        payload,\n        {\n          ...axiosConfig,\n          headers: { Authorization: `Bearer ${token}` },\n        },\n      );\n      // eslint-disable-next-line no-console\n      request.log.info(resData, `${status} response from ${url}`);\n    } catch (err) {\n      request.log.error(err, `Error from homeassistant at ${url} for device ${name}`);\n    }\n  };\n\n  services.forEach(async (service) => {\n    const { deviceLabel = data.name, url, token } = service;\n    const axiosConfig: AxiosRequestConfig = {};\n    if (!url) {\n      request.log.error(`'url' not set for homeassistant service ${deviceLabel}. Data not sent.`);\n    }\n\n    const {\n      temperature,\n      battery,\n      gravity,\n      angle,\n    } = data;\n\n    postData(url, deviceLabel, 'temperature', temperature, '¬∞F', token, axiosConfig);\n    postData(url, deviceLabel, 'battery', battery, 'Volts', token, axiosConfig);\n    postData(url, deviceLabel, 'gravity', gravity, 'SG', token, axiosConfig);\n    postData(url, deviceLabel, 'angle', angle, 'Degrees', token, axiosConfig);\n  });\n};\n"]},"_coverageSchema":"1a1c01bbd47fc00a2c39e90264f33305004495a9","hash":"1ec553df59c012d00473afd281ea716a7173fb3e","contentHash":"bdef0a6ce8616ec17c9c6fb35d2123330e62a8e548c14ac126605b2124cd1209"}}